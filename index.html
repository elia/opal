<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <title>Opal: Ruby runtime for Javascript</title>

  <link rel="stylesheet" href="css/styles.css" type="text/css" media="screen" charset="utf-8">
  <link rel="stylesheet" href="css/syntax.css" type="text/css" media="screen" charset="utf-8">
</head>
<body>
  <div class="content">
    <header>
      <nav>
        <ul>
          <li><a href="index.html">Overview</a></li>
          <li><a href="docs.html">Documentation</a></li>
          <li><a href="repl.html">Try Opal</a></li>
        </ul>
      </nav>
    </header>
    <h1>Opal: Ruby runtime for Javascript</h1>

<p><strong>Homepage</strong>:      <a href="http://opalscript.org">http://opalscript.org</a><br/>
<strong>Github</strong>:
<a href="http://github.com/adambeynon/opal">http://github.com/adambeynon/opal</a></p>

<h2>Overview</h2>

<p>Opal is a ruby runtime and standard library designed to run directly on
top of javascript. It can be run within a browser or on the command line
with the bundled tools. Opal include a parser/compiler written in ruby
that build ruby ahead of time directly into javascript that can run
alongside the bundled runtime.</p>

<div class="highlight"><pre><code class="ruby"><span class="no">Document</span><span class="o">.</span><span class="n">ready</span> <span class="k">do</span>
  <span class="no">Document</span><span class="o">[</span><span class="s1">&#39;a&#39;</span><span class="o">].</span><span class="n">click</span> <span class="k">do</span>
    <span class="n">alert</span> <span class="s2">&quot;Thanks for visiting..&quot;</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
</div>


<h2>Installation and Usage</h2>

<p>Opal is distributed as a gem that includes the ruby compiler and a set
of build tools used to compile the ruby code into javascript that runs
in all modern web browsers. To install ruby from rubygems:</p>

<pre><code>gem install opal
</code></pre>

<p>Once opal has been installed, the <code>opal</code> command is available for use.
The easiest way to get started is to open an opal REPL which acts like
the standard IRB shell. To run the REPL, use:</p>

<pre><code>opal irb
</code></pre>

<p>You can run commands in this REPL in the exact same way you can with
IRB. The REPL relies on <code>therubyracer</code> which embeds the v8 javascript
engine directly inside ruby. The REPL then takes your ruby commands,
parses and compiles them into javascript and runs them in the v8 context
which has the opal runtime loaded. The result is then printed back to
your console after having <code>#inspect</code> called on it.</p>

<h2>Using in the Browser</h2>

<p>Opal is primarily meant to run in the browser. There are two core files
used for running opal in the browser. <code>opal.js</code> contains the ruby
runtime and core library files which is the minimal base needed for
running ruby code in any opal environment. Additionally,
<code>opal-parser.js</code> contains the ruby parser and compiler allowing ruby to
be dynamically loaded and evaluated directly inside the browser. The
parser is only required in development mode to ease compilation of ruby.
Only the ruby runtime is required for production code which is already
compiled.</p>

<p><strong>Latest version</strong>:  0.3.6<br/>
<strong>Opal runtime</strong>: <a href="js/opal.js">opal.js</a><br/>
<strong>Opal parser</strong>: <a href="js/opal-parser.js">opal-parser.js</a></p>

<p>Using the parser, ruby code will automatically be loaded from script
tags in a webpage. Scripts can either contain inline ruby code or
reference external files.</p>

<div class="highlight"><pre><code class="html"><span class="cp">&lt;!doctype html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
  <span class="nt">&lt;title&gt;</span>Opal demo<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;opal.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;opal-parser.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>

  <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/ruby&quot;</span><span class="nt">&gt;</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">].</span><span class="nx">each</span> <span class="p">{</span> <span class="o">|</span><span class="nx">a</span><span class="o">|</span> <span class="nx">puts</span> <span class="nx">a</span> <span class="p">}</span>
  <span class="nt">&lt;/script&gt;</span>

<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre>
</div>


<h2>Features</h2>

<h3>Toll free bridged to native objects</h3>

<p>To make opal fast and efficient, the runtime makes use of native
javascript object whenever possible. Array, String, Number, Regexp and
more are all bridged to ruby objects so the runtime and external
libraries can just deal with native objects instead of casting between
the two environments.</p>

<p>Any native prototype can be toll free bridged to a ruby class using the
<code>Class#native_prototype</code> method which attaches all the necessary methods
and properties onto a native object. For example, to bridge javascript
arrays to instances of the Array class we use:</p>

<div class="highlight"><pre><code class="ruby"><span class="k">class</span> <span class="nc">Array</span>
  <span class="c1"># bridge native arrays</span>
  <span class="n">native_prototype</span> <span class="sb">`Array.prototype`</span>
<span class="k">end</span>
</code></pre>
</div>


<p>This uses the backtick feature outlined below and basically attaches the
releavant properties to the passed in prototype.</p>

<h3>Inline javascript</h3>

<p>While opal aims to be as syntactically close to ruby as possible, one
change is that backticks are used to hold inline javascript inside ruby
code. Infact, most of the core library uses this method. Looking at the
source code of <code>Array#size</code> for instance, we have:</p>

<div class="highlight"><pre><code class="ruby"><span class="k">def</span> <span class="nf">size</span>
  <span class="sb">`return self.length;`</span>
<span class="k">end</span>
</code></pre>
</div>


<p>This inline code simply looks at the arrays length property and returns
it. The entire core library is written in this style.</p>

<h3>Full method_missing support</h3>

<p>Method missing is a cruicial part of ruby and it is fully supported in
Opal. The opal compiler generates optimal javascript code to make method
calls as fast as possible and does not use a method dispatch function
which can cause large slow downs in runtime code.</p>

<h3>Public/Private methods</h3>

<p>Opal fully supports public and private methods in the runtime. Protected
methods are not currently supported and <code>Module#protected</code> acts as a
noop. Method calls do not require a dispatch function so calling public
and private methods has no performance hit.</p>

<h3>And the rest..</h3>

<ul>
<li>Full operator overloading support</li>
<li>Generated code is clean and maintains line numbers</li>
<li>Debug mode to provide clean stack tracers in all browsers</li>
<li>super, metaclasses, block, yield, block_given?, ranges etc..</li>
</ul>


<h1>Changelog</h1>

<p><strong>0.3.6</strong>: 7 July 2011</p>

<ul>
<li>Private/public method support</li>
<li>Method missing for ALL classes</li>
<li>Debug mode to check for arg count errors and full stack traces</li>
</ul>


<p><strong>0.3.5</strong>: 27 June 2011</p>

<ul>
<li>Added method_missing support</li>
<li>Fixed various parts of runtime to allow parser to self compile</li>
<li>Parser runs standalone in browser to run <code>&lt;script&gt;</code> tags</li>
<li>Implemented basic IO classes to allow reassignment of stdin, stdout.</li>
<li>Lots of fixes, additions and improvements to core library</li>
</ul>


  </div>
</body>
</html>

